{% extends "layout.html" %}

{% block content %}
{% if workers.is_empty() %}
<div class="empty-state">
    <p>No active workers.</p>
</div>
{% else %}
<table>
    <thead>
        <tr>
            <th>Worker ID</th>
            <th>State</th>
            <th>Current Task</th>
            <th>Worktree</th>
            <th>Messages</th>
            <th>Last Activity</th>
        </tr>
    </thead>
    <tbody>
        {% for worker in workers %}
        <tr>
            <td><code>{{ worker.id }}</code></td>
            <td>
                {% if worker.state == "error" %}
                <span class="badge badge-error" title="{{ worker.error_message.as_deref().unwrap_or("Unknown error") }}">{{ worker.state }}</span>
                {% else %}
                <span class="badge badge-status">{{ worker.state }}</span>
                {% endif %}
            </td>
            <td>
                {% match worker.current_task %}
                    {% when Some with (task_id) %}
                    <a href="/tasks#{{ task_id }}"><code>{{ task_id }}</code></a>
                    {% when None %}
                    -
                {% endmatch %}
            </td>
            <td>
                {% match worker.worktree %}
                    {% when Some with (path) %}
                    <code title="{{ path }}">{{ path|truncate(40) }}</code>
                    {% when None %}
                    -
                {% endmatch %}
            </td>
            <td>{{ worker.messages_sent }} / {{ worker.messages_received }}</td>
            <td><time>{{ worker.last_activity }}</time></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
